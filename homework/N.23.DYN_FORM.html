<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>N.23 Домашнее задание DYN_FORM</title>
    <style>
      form {
        display: grid;
        justify-items: end;
        margin-bottom: 20px;
      }

      div {
        max-width: fit-content;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <input type="button" value="build form" id="buildform" />
    <div id="container"></div>

    <script>
      const formDef1 = [
        { label: "Название сайта:", kind: "longtext", name: "sitename" },
        { label: "URL сайта:", kind: "longtext", name: "siteurl" },
        { label: "Посетителей в сутки:", kind: "number", name: "visitors" },
        { label: "E-mail для связи:", kind: "shorttext", name: "email" },
        {
          label: "Рубрика каталога:",
          kind: "combo",
          name: "division",
          variants: [
            { text: "здоровье", value: 1 },
            { text: "домашний уют", value: 2 },
            { text: "бытовая техника", value: 3 },
          ],
        },
        {
          label: "Размещение:",
          kind: "radio",
          name: "payment",
          variants: [
            { text: "бесплатное", value: 1 },
            { text: "платное", value: 2 },
            { text: "VIP", value: 3 },
          ],
        },
        { label: "Разрешить отзывы:", kind: "check", name: "votes" },
        { label: "Описание сайта:", kind: "memo", name: "description" },
        { caption: "Опубликовать", kind: "submit" },
      ];

      const formDef2 = [
        { label: "Фамилия:", kind: "longtext", name: "lastname" },
        { label: "Имя:", kind: "longtext", name: "firstname" },
        { label: "Отчество:", kind: "longtext", name: "secondname" },
        { label: "Возраст:", kind: "number", name: "age" },
        { caption: "Зарегистрироваться", kind: "submit" },
      ];

      const buildForm = (arrayWithData) => {
        //create form inside div container
        const form1 = document.createElement("form");
        form1.setAttribute("action", "https://fe.it-academy.by/TestForm.php");
        document.getElementById("container").appendChild(form1);

        const tags = {
          longtext: "input",
          number: "input",
          shorttext: "input",
          combo: "select",
          radio: "input",
          check: "input",
          memo: "textarea",
          submit: "input",
        };

        const types = {
          longtext: 'text',
          number: 'number',
          shorttext: 'email',
          combo : 'option',
          radio : 'radio',
          check : 'checkbox',
          submit : 'submit',
        };

        for (arrayInsideData of arrayWithData) {

          const selectTag = (object) => {
            for (let key in object) {
              if (key === 'kind') if (tags[object[key]]) return tags[object[key]] 
          }};

          const selectType = (object) => {
            for (let key in object) {
             if (types[object[key]]) return types[object[key]];
          }}; 
          // создаем combo и options
          if (arrayInsideData.kind === 'combo' && 'variants' in arrayInsideData) {
            const tag = selectTag(arrayInsideData);
            const elem = document.createElement(tag)
            elem.setAttribute('name',arrayInsideData.name)

            for (variants of arrayInsideData.variants) {
              const labelText = variants.text;
              const value = variants.value; 
              const tag = selectType(arrayInsideData);
              const elemOption = document.createElement(tag);
              elemOption.setAttribute('value',value);
              elemOption.innerText = labelText;
              elem.appendChild(elemOption)
            };

            const label = document.createElement('label');
            const labelValue = document.createTextNode(arrayInsideData.label);
            label.appendChild(labelValue);
            label.appendChild(elem)
            form1.appendChild(label)
          }

          else if (arrayInsideData.kind === 'radio' && 'variants' in arrayInsideData) {

            const label = document.createElement('label');
            const labelValue = document.createTextNode(arrayInsideData.label);
            label.appendChild(labelValue);
            

            for (variants of arrayInsideData.variants) {
              const tag = selectTag(arrayInsideData);
              const type = selectType(arrayInsideData);
              const elem = document.createElement(tag)
              const elemText = document.createTextNode(variants.text)
              elem.setAttribute('name',arrayInsideData.name)
              elem.setAttribute('value',variants.value)
              elem.setAttribute('type',type)
              label.appendChild(elem);
              label.appendChild(elemText);
            };

            form1.appendChild(label);
          }

          else if (arrayInsideData.kind === 'submit' && 'caption' in arrayInsideData) {
            const tag = selectTag(arrayInsideData);
            const type = selectType(arrayInsideData);
            const value = arrayInsideData.caption;
            const elem = document.createElement(tag);
            elem.setAttribute('type', type);
            elem.setAttribute('value', value);
            form1.appendChild(elem);
          }

          else {
            const elem = document.createElement(selectTag(arrayInsideData));
            const label = document.createElement('label');
            const type = selectType(arrayInsideData);
            const labelText = document.createTextNode(arrayInsideData.label);
            elem.setAttribute('name',arrayInsideData.name);
            type != undefined && elem.setAttribute('type',type);
            label.appendChild(labelText);
            label.appendChild(elem);
            form1.appendChild(label);
          }

        } // end of arrayInsideData cycle
      }; // end of buildForm function

      document.getElementById("buildform").addEventListener(
        "click",
        () => {
          buildForm(formDef1), buildForm(formDef2);
        },
        true
      );
    </script>
  </body>
</html>
